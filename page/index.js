
const Home = {
	template: "<div id='home_div'></div>",
	mounted: function () {
		$('#home_div').load('../page/home/home.html');
	}
}

const Pcar = {
	template: "<div id='pcar_div'></div>",
	mounted: function () {
		$('#pcar_div').load('../page/pcars/pcar.html');
	}
}

const My = {
	template: "<div id='my_div'></div>",
	mounted: function () {
		$('#my_div').load('../page/my/my.html');
	}
}

const Subscribe = {
	template: "<div id='subscribe_div'></div>",
	mounted: function () {
		$('#subscribe_div').load('../page/subscribe/subscribe.html');
	}
}

const Notify = {
	template: "<div id='notify_div'></div>",
	mounted: function () {
		$('#notify_div').load('../page/notifys/notify.html');
	}
}

const Product_Add = {
	template: "<div id='product_add_div'></div>",
	mounted: function () {
		$('#product_add_div').load('../page/products/add.html');
	}
}

const Product_List = {
	template: "<div id='product_list_div'></div>",
	mounted: function () {
		$('#product_list_div').load('../page/products/list.html');
	}
}

const Product_Type = {
	template: "<div id='product_type_div'></div>",
	mounted: function () {
		$('#product_type_div').load('../page/products/type.html');
	}
}

const Order_List = {
	template: "<div id='order_list_div'></div>",
	mounted: function () {
		$('#order_list_div').load('../page/orders/list.html');
	}
}

const Order_Info = {
	template: "<div id='order_info_div'></div>",
	mounted: function () {
		$('#order_info_div').load('../page/orders/info.html');
	}
}

const Home_Config_Info = {
	template: "<div id='home_config_info_div'></div>",
	mounted: function () {
		$('#home_config_info_div').load('../page/homeconfig/info.html');
	}
}

const Admin_Edit = {
	template: "<div id='admin_edit_div'></div>",
	mounted: function () {
		$('#admin_edit_div').load('../page/admins/edit.html');
	}
}

const Admin_List = {
	template: "<div id='admin_list_div'></div>",
	mounted: function () {
		$('#admin_list_div').load('../page/admins/list.html');
	}
}

const Admin_Info = {
	template: "<div id='admin_info_div'></div>",
	mounted: function () {
		$('#admin_info_div').load('../page/admins/info.html');
	}
}

const User_List = {
	template: "<div id='user_list_div'></div>",
	mounted: function () {
		$('#user_list_div').load('../page/users/list.html');
	}
}

const User_Action = {
	template: "<div id='user_action_div'></div>",
	mounted: function () {
		$('#user_action_div').load('../page/users/action.html');
	}
}

const User_Verify_List = {
	template: "<div id='user_verify_list_div'></div>",
	mounted: function () {
		$('#user_verify_list_div').load('../page/users/verify_list.html');
	}
}

const Fun_List = {
	template: "<div id='fun_list_div'></div>",
	mounted: function () {
		$('#fun_list_div').load('../page/funs/list.html');
	}
}

const Pocket_List = {
	template: "<div id='pocket_list_div'></div>",
	mounted: function () {
		$('#pocket_list_div').load('../page/pockets/list.html');
	}
}

const Pocket_Info = {
	template: "<div id='pocket_info_div'></div>",
	mounted: function () {
		$('#pocket_info_div').load('../page/pockets/info.html');
	}
}

const Live_Jx_List = {
	template: "<div id='live_jx_list_div'></div>",
	mounted: function () {
		$('#live_jx_list_div').load('../page/live/jx_list.html');
	}
}

const Live_Jx_Info = {
	template: "<div id='live_jx_info_div'></div>",
	mounted: function () {
		$('#live_jx_info_div').load('../page/live/jx_info.html');
	}
}

const Live_Dk_List = {
	template: "<div id='live_dk_list_div'></div>",
	mounted: function () {
		$('#live_dk_list_div').load('../page/live/dk_list.html');
	}
}

const Live_Dk_Info = {
	template: "<div id='live_dk_info_div'></div>",
	mounted: function () {
		$('#live_dk_info_div').load('../page/live/dk_info.html');
	}
}

const Post_Jx_List = {
	template: "<div id='post_jx_list_div'></div>",
	mounted: function () {
		$('#post_jx_list_div').load('../page/post/jx_list.html');
	}
}

const Post_Jx_Info = {
	template: "<div id='post_jx_info_div'></div>",
	mounted: function () {
		$('#post_jx_info_div').load('../page/post/jx_info.html');
	}
}

const Activity_List = {
	template: "<div id='activity_list_div'></div>",
	mounted: function () {
		$('#activity_list_div').load('../page/activity/list.html');
	}
}

const Activity_Info = {
	template: "<div id='activity_info_div'></div>",
	mounted: function () {
		$('#activity_info_div').load('../page/activity/info.html');
	}
}

const Material_Info = {
	template: "<div id='material_info_div'></div>",
	mounted: function () {
		$('#material_info_div').load('../page/material/info.html');
	}
}

const Material_List = {
	template: "<div id='material_list_div'></div>",
	mounted: function () {
		$('#material_list_div').load('../page/material/list.html');
	}
}

const WxMaterial_List = {
	template: "<div id='wxmaterial_list_div'></div>",
	mounted: function () {
		$('#wxmaterial_list_div').load('../page/wxmaterial/list.html');
	}
}
const WxMaterial_Create = {
	template: "<div id='wxmaterial_create_div'></div>",
	mounted: function () {
		$('#wxmaterial_create_div').load('../page/wxmaterial/create.html');
	}
}
const WxMaterial_Info = {
	template: "<div id='wxmaterial_info_div'></div>",
	mounted: function () {
		$('#wxmaterial_info_div').load('../page/wxmaterial/info.html');
	}
}

const Activity_Video_Info = {
	template: "<div id='activity_video_info_div'></div>",
	mounted: function () {
		$('#activity_video_info_div').load('../page/activity_video/info.html');
	}
}

const Activity_Video_List = {
	template: "<div id='activity_video_list_div'></div>",
	mounted: function () {
		$('#activity_video_list_div').load('../page/activity_video/list.html');
	}
}

const Admin_Logger_List = {
	template: "<div id='admin_logger_list_div'></div>",
	mounted: function () {
		$('#admin_logger_list_div').load('../page/admins/oper_logger_list.html');
	}
}

const Privacy_Edit = {
	template:"<div id='privacy_edit_div'></div>",
	mounted:function(){
		$('#privacy_edit_div').load('../page/privacy/edit.html')
	}
}
const Privacy_List = {
	template:"<div id='privacy_list_div'></div>",
	mounted:function(){
		$('#privacy_list_div').load('../page/privacy/list.html')
	}
}
const Datas_survey_List = {
	template:"<div id='datas_survey_list_div'></div>",
	mounted:function(){
		$('#datas_survey_list_div').load('../page/dataAnalysis/survey.html')
	}
}
const Datas_trend_List = {
	template:"<div id='datas_trend_list_div'></div>",
	mounted:function(){
		$('#datas_trend_list_div').load('../page/dataAnalysis/trend.html')
	}
}
const Datas_distribution_List = {
	template:"<div id='datas_distribution_list_div'></div>",
	mounted:function(){
		$('#datas_distribution_list_div').load('../page/dataAnalysis/distribution.html')
	}
}
const Datas_visit_List = {
	template:"<div id='datas_visit_list_div'></div>",
	mounted:function(){
		$('#datas_visit_list_div').load('../page/dataAnalysis/visit.html')
	}
}
const Datas_eailyretain_List = {
	template:"<div id='datas_eailyretain_list_div'></div>",
	mounted:function(){
		$('#datas_eailyretain_list_div').load('../page/dataAnalysis/eailyretain.html')
	}
}
const Datas_userPortrait_List = {
	template:"<div id='datas_userPortrait_list_div'></div>",
	mounted:function(){
		$('#datas_userPortrait_list_div').load('../page/dataAnalysis/userPortrait.html')
	}
}
const Datas_article_List = {
	template:"<div id='datas_article_list_div'></div>",
	mounted:function(){
		$('#datas_article_list_div').load('../page/dataAnalysis/article.html')
	}
}
const Datas_userdatas_List = {
	template:"<div id='datas_userdatas_list_div'></div>",
	mounted:function(){
		$('#datas_userdatas_list_div').load('../page/dataAnalysis/userdatas.html')
	}
}
const Datas_message_List = {
	template:"<div id='datas_message_list_div'></div>",
	mounted:function(){
		$('#datas_message_list_div').load('../page/dataAnalysis/message.html')
	}
}
const Sign_manage_List = {
	template:"<div id='sign_manage_list_div'></div>",
	mounted:function(){
		$('#sign_manage_list_div').load('../page/signManage/signmanagelist.html')
	}
}

const Point_Set = {
	template: "<div id='point_set_div'></div>",
	mounted: function () {
		$('#point_set_div').load('../page/users/pointset.html');
	}
}

const Video_Create = {
	template: "<div id='video_create_div'></div>",
	mounted: function () {
		$('#video_create_div').load('../page/users/videocreate.html');
	}
}

const Video_Set = {
	template: "<div id='video_set_div'></div>",
	mounted: function () {
		$('#video_set_div').load('../page/users/videoset.html');
	}
}

const Match_Set = {
	template: "<div id='match_set_div'></div>",
	mounted: function () {
		$('#match_set_div').load('../page/users/matchset.html');
	}
}

const Match_Audit = {
	template: "<div id='match_audit_div'></div>",
	mounted: function () {
		$('#match_audit_div').load('../page/users/matchaudit.html');
	}
}

const Nav_Manage = {
	template: "<div id='nav_manage_div'></div>",
	mounted: function () {
		$('#nav_manage_div').load('../page/users/navmanage.html');
	}
}

const Vote_Create = {
	template: "<div id='vote_create_div'></div>",
	mounted: function () {
		$('#vote_create_div').load('../page/users/votecreate.html');
	}
}

const Vote_Manage = {
	template: "<div id='vote_manage_div'></div>",
	mounted: function () {
		$('#vote_manage_div').load('../page/users/votemanage.html');
	}
}

const Qa_Create = {
	template: "<div id='qa_create_div'></div>",
	mounted: function () {
		$('#qa_create_div').load('../page/users/qacreate.html');
	}
}

const Qa_Manage = {
	template: "<div id='qa_manage_div'></div>",
	mounted: function () {
		$('#qa_manage_div').load('../page/users/qamanage.html');
	}
}

const Answer_Create = {
	template: "<div id='answer_create_div'></div>",
	mounted: function () {
		$('#answer_create_div').load('../page/users/answercreate.html');
	}
}

const Answer_Manage = {
	template: "<div id='answer_manage_div'></div>",
	mounted: function () {
		$('#answer_manage_div').load('../page/users/answermanage.html');
	}
}

const Team_Create = {
	template: "<div id='team_create_div'></div>",
	mounted: function () {
		$('#team_create_div').load('../page/users/teamcreate.html');
	}
}

const Team_Manage = {
	template: "<div id='team_manage_div'></div>",
	mounted: function () {
		$('#team_manage_div').load('../page/users/teammanage.html');
	}
}

const Point_Manage = {
	template: "<div id='point_manage_div'></div>",
	mounted: function () {
		$('#point_manage_div').load('../page/users/pointmanage.html');
	}
}

const routes = [{
		path: '/pocket_info',
		component: Pocket_Info
	},{
		path: '/pocket_info',
		component: Pocket_Info
	},{
		path: '/admin_logger_list',
		component: Admin_Logger_List
	},{
		path: '/wxmaterial_list',
		component: WxMaterial_List
	},{
		path: '/wxmaterial_create',
		component: WxMaterial_Create
	},{
		path: '/wxmaterial_info',
		component: WxMaterial_Info
	},{
		path: '/material_info',
		component: Material_Info
	},{
		path: '/material_list',
		component: Material_List
	},{
		path: '/activity_video_info',
		component: Activity_Video_Info
	},{
		path: '/activity_video_list',
		component: Activity_Video_List
	},{
		path: '/pocket_list',
		component: Pocket_List
	}, {
		path: '/pocket_info',
		component: Pocket_Info
	},{
		path: '/live_jx_list',
		component: Live_Jx_List
	}, {
		path: '/live_jx_info',
		component: Live_Jx_Info
	},{
		path: '/live_dk_list',
		component: Live_Dk_List
	}, {
		path: '/live_dk_info',
		component: Live_Dk_Info
	},{
		path: '/post_jx_list',
		component: Post_Jx_List
	}, {
		path: '/post_jx_info',
		component: Post_Jx_Info
	},{
		path: '/activity_list',
		component: Activity_List
	}, {
		path: '/activity_info',
		component: Activity_Info
	}, {
		path: '/home',
		component: Home
	},
	{
		path: '/pcar',
		component: Pcar
	},
	{
		path: '/my',
		component: My
	}, {
		path: '/subscribe',
		component: Subscribe
	},
	{
		path: '/notify',
		component: Notify
	},
	{
		path: '/product_add',
		component: Product_Add
	},
	{
		path: '/product_list',
		component: Product_List
	}, {
		path: '/product_type',
		component: Product_Type
	}, {
		path: '/order_list',
		component: Order_List
	}, {
		path: '/order_info',
		component: Order_Info
	}, {
		path: '/home_config_info',
		component: Home_Config_Info
	},
	{
		path: '/admin_edit',
		component: Admin_Edit
	},
	{
		path: '/admin_list',
		component: Admin_List
	},
	{
		path: '/admin_info',
		component: Admin_Info
	},
	{
		path: '/user_list',
		component: User_List
	},{
		path: '/user_action',
		component: User_Action
	},
	{
		path: '/user_verify_list',
		component: User_Verify_List
	},
	{
		path: '/fun_list',
		component: Fun_List
	},
	{
		path:'/privacy_edit',
		component:Privacy_Edit
	},
	{
		path:'/privacy_list',
		component:Privacy_List
	},
	{
		path:'/analysis_applet_daily_summary',
		component:Datas_survey_List
	},
	{
		path:'/analysis_applet_daily_visittrend',
		component:Datas_trend_List
	},
	{
		path:'/analysis_applet_visitdistribution',
		component:Datas_distribution_List
	},
	{
		path:'/analysis_visitpage',
		component:Datas_visit_List
	},
	{
		path:'/analysis_eailyretain',
		component:Datas_eailyretain_List
	},
	{
		path:'/analysis_userPortrait',
		component:Datas_userPortrait_List
	},
	{
		path:'/analysis_article',
		component:Datas_article_List
	},
	{
		path:'/analysis_userdatas',
		component:Datas_userdatas_List
	},
	{
		path:'/analysis_message',
		component:Datas_message_List
	},
	{
		path:'/sign_manage',
		component:Sign_manage_List
	},{
		path: '/point_set',
		component: Point_Set
	},
	{
		path: '/video_create', // 直播管理-创建直播
		component: Video_Create
	},
	{
		path: '/video_set', // 直播管理-直播设置
		component: Video_Set
	},
	{
		path: '/match_set', // 科普大赛-大赛设置
		component: Match_Set
	},
	{
		path: '/match_audit', // 科普大赛-参赛作品审核
		component: Match_Audit
	},
	{
		path: '/nav_manage', // 栏目管理
		component: Nav_Manage
	},
	{
		path: '/vote_create', // 投票管理-创建
		component: Vote_Create
	},
	{
		path: '/vote_manage', // 投票管理-管理
		component: Vote_Manage
	},
	{
		path: '/qa_create', // 调研问卷-创建
		component: Qa_Create
	},
	{
		path: '/qa_manage', // 调研问卷-管理
		component: Qa_Manage
	},
	{
		path: '/answer_create', // 线上答题-创建
		component: Answer_Create
	},
	{
		path: '/answer_manage', // 线上答题-管理
		component: Answer_Manage
	},
	{
		path: '/team_create', // 团队竞赛-创建
		component: Team_Create
	},
	{
		path: '/team_manage', // 团队竞赛-管理
		component: Team_Manage
	},
	{
		path: '/point_manage', // 商城管理-积分规则
		component: Point_Manage
	},
	{
		path: '*',
		redirect: ''
	} /*默认跳转路由*/
];

const router = new VueRouter({
	routes // (缩写) 相当于 routes: routes
});

// router.beforeEach((to,from,next) => {
// 	console.log(storage.get("userInfo"))
// 	if(storage.get("userInfo") != null ){//如果name为真就true,为假就false
// 		// if(to.path == from.path){
// 		// 	if(JSON.stringify(to.query) !== JSON.stringify(from.query)){
// 		// 		next()
// 		// 		window.location.reload()
// 		// 	}
// 		// }
// 		next()
// 	}else{
// 		// next('/')
// 		window.location.href= "https://"+window.location.host+"/yake.manage/page/index.html#/";
// 		return;
// 	}
// });

//极验的一些东西
// var handler = function (captchaObj) {
// 	captchaObj.onReady(function () {
// 		console.log('ready');
// 	}).onSuccess(function () {
// 		var result = captchaObj.getValidate();
// 		if (!result) {
// 			return alert('请完成验证');
// 		}
// 		console.log('验证完成')
// 		// $.ajax({
// 		// 	url: 'gt/validate-slide',
// 		// 	type: 'POST',
// 		// 	dataType: 'json',
// 		// 	data: {
// 		// 		username: $('#username2').val(),
// 		// 		password: $('#password2').val(),
// 		// 		geetest_challenge: result.geetest_challenge,
// 		// 		geetest_validate: result.geetest_validate,
// 		// 		geetest_seccode: result.geetest_seccode
// 		// 	},
// 		// 	success: function (data) {
//
// 		// 	}
// 		// });
// 		var params = {
// 			geetest_challenge: result.geetest_challenge,
//             geetest_validate: result.geetest_validate,
//             geetest_seccode: result.geetest_seccode,
//             cellphone: $("#loginName").val().trim(),
//             type: 1
// 		}
// 		$.ajax({
// 			url:'/yake.manage/api/admin/sms/send',
// 			type:'post',
// 			dataType:'json',
// 			data:params,
// 			success:function(data){
// 				if(data.status == 1000){
// 					indexVue.getyzm();
// 				}
// 				console.log(data)
// 			}
// 		})
// 	});
// 	$('#getCaptcha').click(function () {
// 		// 调用之前先通过前端表单校验
//
//
// 		captchaObj.verify();
// 	});
// 	// 更多接口说明请参见：http://docs.geetest.com/install/client/web-front/
// };
// $.ajax({
// 	url: "/yake.manage/api/admin/geetest/init", // 加随机数防止缓存
// 	type: "get",
// 	dataType: "json",
// 	success: function (data) {
// 		console.log(data);
// 		// 调用 initGeetest 进行初始化
// 		// 参数1：配置参数
// 		// 参数2：回调，回调的第一个参数验证码对象，之后可以使用它调用相应的接口
// 		if(data.status == 1000){
// 			initGeetest({
// 				// 以下 4 个配置参数为必须，不能缺少
// 				gt: data.data.gt,
// 				challenge: data.data.challenge,
// 				offline: !data.data.success, // 表示用户后台检测极验服务器是否宕机
// 				product: "bind", // 产品形式，包括：float，popup
//
// 				// 更多配置参数说明请参见：http://docs.geetest.com/install/client/web-front/
// 			}, handler);
// 		}
//
// 	}
// });

var indexVue = new Vue({
	el: '#master_index_div',
	router,
	data: {
		loginName: '',
		func_datas: [],
		btnBool:false,
		yzmtext:'获取验证码',
	},
	methods: {
		getyzm() {
			var that = this
			that.btnBool = true;
			var i = 60;
			var timer = setInterval(function () {
			  that.yzmtext = '获取验证码' + i + 's';
			  i--;
			  if (i < 0) {
				that.btnBool = false;
				that.yzmtext = '获取验证码';
				clearInterval(timer);
			  }
			}, 1000);
		},
		confimLogin: function () {
			var _this = this;
			var mobile = $("#loginName").val().trim();
			var password = $("#loginPassword").val().trim();
			// 之后会改回来 var captcha = $('#verificationCode').val().trim();
			var captcha = '';
			var reg = /^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_]+$)(?![a-z0-9]+$)(?![a-z\W_]+$)(?![0-9\W_]+$)[a-zA-Z0-9\W_]{8,20}$/;
			if (password === '') {
				$("#login_tip").show();
				$("#login_tip").text('请输入密码');
				return;
			} else {
				$("#login_tip").hide();
			}
			login.confimLog(mobile, password,captcha);
			
			var userInfo = storage.get("userInfo");
			if (userInfo != null) {
				_this.loginName = userInfo.mobile;
				_this.func_datas = userInfo.funcs;
				// console.log('lcc2',_this.func_datas)
				$("#login_tip").hide();
				setTimeout(() => {
					_this.load_li_click();
				}, 200);
				setTimeout(() => {
					$("#loginName").val("");
					$("#loginPassword").val("");
				}, 100);
			} 
			// else {
			// 	$("#login_tip").show();
			// 	$("#login_tip").text('手机号或密码或验证码错误')
			// }
		},
		load_li_click: function () {
			$('.js-category').click(function (event) {
				event.stopImmediatePropagation();
				$parent = $(this).parent('li');
				if ($parent.hasClass('js-show')) {
					$parent.removeClass('js-show');
					$(this).children('i').removeClass('icon-35').addClass('icon-74');
				} else {
					$parent.siblings().removeClass('js-show');
					$parent.addClass('js-show');
					$(this).children('i').removeClass('icon-74').addClass('icon-35');
					$parent.siblings().find('i').removeClass('icon-35').addClass('icon-74');
				}
			});
		},
		exit: function () {
			HttpUtils.requestPost("/api/admin/exit", null, function (dataResult) {
				if (dataResult.status == 1000) {
					storage.set("userInfo", null);
					cookies.remove("cmtgsk")
					router.push({
						path: 'admin_info'
					});
					login.showLogin();
					$('#loginName').val('');
				}
			});
			
		}
	},
	updated: function () { //组件更新之后执行的方法

		var currentPath = router.history.current.path;
	},
	mounted: function () {
		setInterval(() => {
			console.log('lc2',window.location.href)
			window.location.href = window.location.href + '?time=' + new Date().getTime();
		}, 500);
		try{
			top.location.hostname;
			if (top.location.hostname != window.location.hostname) {
			  top.location.href =window.location.href;
			}
		} catch (e){
			top.location.href = window.location.href;
		}
		var _this = this;
		var userInfo = storage.get("userInfo");
		if (userInfo == null) {
			login.showLogin();
			$('#loginName').val('');
		} else {
			login.hideLogin();
			this.loginName = userInfo.mobile;
			this.func_datas = userInfo.funcs;
			// console.log('lcc',_this.func_datas)
			setTimeout(() => {
				_this.load_li_click();
			}, 200);
		}
	}
});